# Create an Azure storage account and a key vault

The e-Invoicing service takes responsibility for storing all your business data
in the Microsoft Azure resources that are owned by your company. To ensure that
the service works correctly, and all the business data that is needed for the
e-Invoicing service and generated by the e-Invoicing service is accessed only by
the service, you must create two main Azure resources:

-   An Azure storage account (Blob storage) to store electronic invoices

-   An Azure key vault to store certificates and the Uniform Resource Identifier
    (URI) of the storage account

Note: A dedicated key vault resource and customer Blob storage must be allocated
specifically for use with the e-Invoicing service.

# Prerequisites

Before you can complete the steps in this topic, you must make sure that the
following tasks have been completed:

-   Create a key vault resource in Azure. For more information, see [About Azure
    Key Vault](https://docs.microsoft.com/azure/key-vault/general/overview).

-   Create an Azure storage account (Blob storage). For more information, see
    [Maintaining Azure Storage
    Account](https://docs.microsoft.com/azure/storage/blobs/).

# Overviews

In this topic, you will complete two main steps:

-   Set up the Azure storage account to get the storage account URI.

-   Set up the key vault to store the storage account URI.

# Set up the Azure storage account to get the storage account URI

1.  Open the storage account that you plan to use with the e-Invoicing service.

2.  Go to **Blob service** \> **Containers**, and create a new container.

3.  Enter a name for the container, and set the **Public access level** field to
    **Private (no anonymous access)**.

4.  Open the container that you just created, and go to **Settings \> Access
    policy**.

5.  Select **Add policy** to add a stored access policy.

6.  Set the **Identifier** and **Permissions** fields as appropriate. In the
    **Permissions** field, you should select all permissions.

![Grant blob permission](media/e-Invoicing-services-create-azure-resources-grant-blob-permissions.png)

1.  Enter the start and expiry dates. The expiry date should be in future.

2.  Select **OK** to save the policy, and then save your changes to the
    container.

3.  Return to the storage account, and open **Storage Explorer (preview)**.

4.  Right-click the container, and then select **Get Shared Access Signature**.

5.  In the **Shared Access Signature** dialog box, copy and store the value in
    the **URI** field. This value will be used in the next procedure and will be
    referred to as the *shared access signature URI*.

![Select and copy URI](media/e-Invoicing-services-create-azure-resources-select-and-copy-uri.png)

# Set up the key vault to store the storage account URI

1.  Open the key vault you intend to use with the e-Invoicing service.

2.  Go to **Settings** \> **Secrets**, and then select **Generate/Import** to
    create a new secret.

3.  On the **Create a secret** page, in the **Upload options** field, select
    **Manual**.

4.  Enter the name of the secret. This name will be used during setup of the
    service in Regulatory Configuration Service (RCS) and will be referred to as
    the *key vault secret name*.

5.  In the **Value** field, select **Shared Access Signature URI**, and then
    select **Create**.

6.  You must set up the access policy to grant the e-Invoicing service the
    correct level of secure access to the secrete that you created. Go to
    **Settings \> Access policy**, and select **Add Access Policy**.

7.  Set the secret permissions for the **Get** and **List** operations.

![Grant service access](media/e-Invoicing-services-create-azure-resources-grant-service-access.png)

1.  Set the certificate permissions for **Get** and **List** operations:

![Grant certificate permission](media/e-Invoicing-services-create-azure-resources-grant-certificate-permission.png)

1.  In the **Principal** dialog box, select the principal by adding
    **e-Invoicing Service**.

2.  Select **Add**, and then select **Save Key Vault changes**.

3.  On the **Overview** page, copy the **DNS name** value for the key vault.
    This value will be used during setup of the service in RCS and will be
    referred as the *key vault URI*.
